<!--
ARCHES - a program developed to inventory and manage immovable cultural heritage.
Copyright (C) 2013 J. Paul Getty Trust and World Monuments Fund

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
-->
{% extends "base-manager.htm" %}
{% load staticfiles %}
{% load i18n %}


{% block title %}
{{ block.super }}
{% trans "Mobile Project Manager" %}
{% endblock title %}


{% block main_content %}
<div class="content-panel mobile-project-manager-editor">
    <div class="flex">

        <!-- Left Panel: Groups/Accounts -->
        <div class="left-column-container panel ep-card-tools-panel" style="flex: 0 0 270px;">

            <!-- Title Block -->
            <div class="title-block-title">
                <div class="layer-list">
                    <!-- Layer Filter -->
                    <div class="list-filter" data-bind="" style="margin-right: 10px;">
                        <h4 class="title-block-title">Projects</h4>
                        <input type="text" class="form-control" style="width: 250px;" placeholder="Find a project..." data-bind="value: projectFilter, valueUpdate: 'keyup'">

                        <!-- Clear Search -->
                        <span class="clear-node-search" data-bind="visible: projectFilter().length > 0, click: function() { projectFilter(''); }"><i class="fa fa-times-circle"></i></span>
                    </div>

                </div>
            </div>



            <!-- Project Listing Panel-->
            <div id="user-grid" class="grid" style="position: relative; height: 0px; margin-left: -7px; display:none;" data-bind="visible: true">

                <!-- ko if: projects().length ===  0 -->
                <div id="default-message-panel" class="left-column-message" style="">
                    {% trans "You haven't saved any projects." %}
                    <p class="default-message">
                        {% trans "Use the form to set up a project, then save your edits, and you're done!" %}
                    </p>
                </div>
                <!-- /ko -->

                <!-- ko if: projects().length >  0 -->
                <div id="project-listing-panel" class="library-card library-card-entry library-card-wide selected" style="width: 270px;">
                    <!-- ko foreach: filteredProjects() -->
                    <div class="library-card selected selected-card" data-bind="css: {'selected-card': $parent.selectedProject()===$data, 'inactive': !active()}, click: $parent.selectedProject" style="width: 270px;">
                        <div class="mpm-project-card">
                            <a class="mpm-project-name" data-bind="text: name() === '' ? '{% trans "Unnamed Project" %}' : name()"></a>
                        </div>
                        <div class="mpm-project-status" data-bind="text: active() ? '{% trans "Active" %}' : '{% trans "Inactive" %}'"></div>
                        <div class="mpm-project-subtitle" data-bind="text: createdbyName"></div>
                    </div>
                    <!-- /ko -->
                </div>
                <!-- /ko -->
            </div>
        </div>


        <div id="" class="card-form-preview-container library-container">
            <div class="">

                <!-- Header -->
                <div class="relative library-header" style="height: 55px;">

                    <!-- Add Project -->
                    <div class="library-panel-search-bar">
                        <button id="" class="btn btn-lg btn-mint btn-active-dark btn-labeled ion-plus-round" data-bind="click: newProject">{% trans "New Project" %}</button>

                    </div>
                </div>

                <div id="page-content" class="library-grid" style="display:none;" data-bind="visible: true">

                    <!-- ko if: selectedProject() -->
                    <div id="sample-project" class="project-panel">

                        <!--Project heading-->
                        <div class="project-panel-header edit-mode">
                            <div class="">
                                <div class="project-status" data-bind="css: selectedProject().active() ? 'active' : 'inactive', text: selectedProject().active() ? '{% trans "Active" %}' : '{% trans "Inactive" %}'"></div>
                            </div>
                            <h3 class="project-panel-title" data-bind="text: selectedProject().name() === '' ? '{% trans "Unnamed Project" %}' : selectedProject().name()"></h3>

                            <div class="">
                                <ul class="project-metadata">
                                    <li class="project-metadata-item">
                                        PROJECT DATE RANGE HERE...
                                    </li>
                                </ul>
                                <div class="project-details" data-bind="if: selectedProject().dirty">
                                    <button id="btn-save-edits" class="btn btn-primary btn-labeled btn-active-dark fa fa-check" data-bind="click: saveProject">Save Edits</button>
                                    <button class="btn btn-danger btn-labeled btn-active-dark fa fa-undo" data-bind="click: discardEdits">Discard Edits</button>
                                </div>
                            </div>
                        </div>

                        <!--Project Details-->
                        <div id="project-details" class="project-panel-body" style="">

                            <div id="card-preview-crud" class="panel-body card-body fade in" style="padding: 0px; margin: 0px;">
                                <div id="cards" class="tab-base card-content-container outline" style="margin: 0px; margin-top: 0px;">

                                    <!--Nav Tabs-->
                                    <ul class="nav nav-tabs card-nav-container" style="">
                                        <li id="summary-group" class="active">
                                            <a id="summary-tab" data-toggle="tab" href="#summary-card" class="card-tab-title" aria-expanded="true">
                                                                Basic Settings
                                                            </a>
                                        </li>
                                        <li id="card-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#location-card" class="card-tab-title" aria-expanded="false">
                                                                Location
                                                            </a>
                                        </li>
                                        <li id="icon-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#models-card" class="card-tab-title" aria-expanded="false">
                                                                Resources
                                                            </a>
                                        </li>
                                        <li id="status-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#identities-card" class="card-tab-title" aria-expanded="false">
                                                                People
                                                            </a>
                                        </li>
                                        <li id="activation-group" class="">
                                            <a id="map-tab" data-toggle="tab" href="#activation-card" class="card-tab-title" aria-expanded="false">
                                                                Manage Project
                                                            </a>
                                        </li>
                                    </ul>

                                    <!--Tabs Content-->
                                    <div class="tab-content card-content-tab" style="margin-left: 0px;">

                                        <!-- Summary Card -->
                                        <div id="summary-card" class="tab-pane fade active in" style="">
                                            <div class="panel-body card-panel-body project-card-body">
                                                <div id="" class="card-content">

                                                    <!-- Project Info -->
                                                    <section id="" class="profile-list edit-mode">
                                                        <div class="account-wrapper">
                                                            <div class="row relative">


                                                                <!-- Section Content -->
                                                                <div class="col-sm-12">

                                                                    <!-- Account CRUD Panel -->
                                                                    <div id="account-crud" class="" style="">
                                                                        <!-- User Name, Password -->
                                                                        <div class="row">
                                                                            <!-- User Name -->
                                                                            <div class="col-sm-5">
                                                                                <div class="form-group">
                                                                                    <label class="control-label account-label">Project name</label>
                                                                                    <input type="text" class="form-control input-lg account-input" data-bind="value: selectedProject().name, valueUpdate: 'keyup'">
                                                                                </div>
                                                                            </div>

                                                                            <!-- Password -->
                                                                            <div class="col-sm-6">
                                                                                <p class="account-tips">
                                                                                    Pick a concise name that makes it easy for people to find your project
                                                                                </p>
                                                                            </div>
                                                                        </div>

                                                                        <hr style="border-color: #eee;">

                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </section>

                                                </div>
                                            </div>
                                        </div>

                                        <!-- Map Card -->
                                        <div id="location-card" class="tab-pane fade">
                                            Location....
                                        </div>

                                        <!-- Models Card -->
                                        <div id="models-card" class="tab-pane fade">
                                            Models...
                                        </div>

                                        <div id="identities-card" class="identities-list tab-pane fade">

                                            <div>
                                                <div>
                                                    <div class="flex relative">

                                                        <div class="mpm-left-panel" style="" data-bind="with:identityList">
                                                            {% include 'views/project-manager/identity-list.htm' %}
                                                        </div>

                                                        <div class="mpm-right-panel">

                                                            <div class="relative">

                                                                <div class="row">
                                                                    <div class="col-xs-12 col-sm-5 col-md-6">
                                                                        <!-- ko if: selectedProject().identities.selected().type === 'group' -->
                                                                        <span class="icon-wrap icon-wrap-sm icon-circle branch-icon bg-purple">
                                                                                                                            <i class="fa fa-group"></i>
                                                                                                                        </span>
                                                                        <div class="mpm-group-name">
                                                                            <a class="listitem_name" data-bind='text:selectedProject().identities.selected().name'></a>
                                                                        </div>
                                                                        <div class="mpm-group-subtitle">{% trans 'Arches Group' %} </div>
                                                                        <!-- /ko -->
                                                                        <!-- ko if: selectedProject().identities.selected().type === 'user' -->
                                                                        <span class="icon-wrap icon-wrap-sm icon-circle branch-icon bg-mint">
                                                                                                                            <i class="fa fa-user"></i>
                                                                                                                        </span>
                                                                        <div class="mpm-group-name">
                                                                            <a class="listitem_name" data-bind='text:selectedProject().identities.selected().name'></a>
                                                                        </div>
                                                                        <div class="mpm-group-subtitle" data-bind="">{% trans 'Arches User' %}</div>
                                                                        <!-- /ko -->
                                                                    </div>
                                                                    <div class="col-sm-6" style="" data-bind="">
                                                                        <div class="box-inline">
                                                                            <!-- ko if: selectedProject().identities.selected().type === 'group' -->
                                                                            <p class="" style="margin-bottom: 0px;">{% trans 'Add this group to project' %}</p>
                                                                            <!-- /ko -->
                                                                            <!-- ko if: selectedProject().identities.selected().type === 'user' -->
                                                                            <p class="" style="margin-bottom: 0px;">{% trans 'Add this user to project' %}</p>
                                                                            <!-- /ko -->
                                                                            <div class="toggle-container">
                                                                                <span class="switch switch-small" data-bind="css: {'on': selectedProject().hasIdentity()}, click: function(){selectedProject().toggleIdentity()}"><small></small></span>
                                                                                        <div style="display:flex; flex-direction:row;">
                                                                                        <div class="arches-toggle-sm"></div>
                                                                                            <div style="margin-top: -17px;"></div>
                                                                                        </div>
                                                                                <span class="arches-toggle-subtitle"></span>
                                                                            </div>


                                                                        </div>

                                                                    </div>
                                                                </div>

                                                                <!-- Users in this Account -->
                                                                <div class="mpm-account-detail-panel">

                                                                    <!-- User Listing -->
                                                                    <div id="user-cards" class="list-group user-cards">
                                                                        <!-- Title/Filter/Pagination -->
                                                                        <!--ko if: selectedProject().identities.selected().type === 'group' -->
                                                                        <div class="relative mpm-item-listing-header-panel">
                                                                            <h4 class="mpm-item-listing-header">{% trans 'Accounts in this group' %}</h4>
                                                                            <div class="project-search-widget mpm-item-listing">
                                                                                <input class="form-control input-lg" placeholder="find a user..." type="text" data-bind="value: selectedProject().userFilter, valueUpdate: 'keyup'">
                                                                            </div>
                                                                        </div>

                                                                        <!-- ko foreach: selectedProject().filteredUsers() -->
                                                                            <a href="#" class="list-group-item get-user-detail">
                                                                                <div class="mpm-user-title mpm-user-name"><h4 data-bind='text: $data.username'></h4>
                                                                                <!--ko if: $data.groups-->
                                                                                    <!--ko if: _.contains($parent.selectedProject().users(), $data.id) -->
                                                                                    <div class='mpm-user-status invited pull-right'>
                                                                                        <span>{% trans 'Approved' %}</span>
                                                                                    </div>
                                                                                    <!--/ko-->
                                                                                    <!--ko ifnot: _.contains($parent.selectedProject().users(), $data.id) -->
                                                                                    <div class='mpm-user-status pull-right'>
                                                                                        <span>{% trans 'Not Approved' %}</span>
                                                                                    </div>
                                                                                    <!--/ko-->
                                                                                <!--/ko-->
                                                                            </div>
                                                                                <div class="mpm-user-subtitle"><p>{% trans 'Activity: 0 edits' %}</p><div><span>{% trans 'Last Login:' %}</span><span class="last-login" data-bind="text: $data.last_login"></span></div></div>
                                                                            </a>
                                                                        <!-- /ko -->
                                                                        <!--/ko-->

                                                                        <!--ko if: selectedProject().identities.selected().type === 'user' -->
                                                                        <a href="#" class="get-user-detail">
                                                                            <div class="mpm-user-title mpm-user-name">
                                                                                    <!--ko if: selectedProject().identities.selected().approved() -->
                                                                                    <div class='mpm-user-status invited user'>
                                                                                        <span>{% trans 'Approved' %}</span>
                                                                                    </div>
                                                                                    <!--/ko-->
                                                                                    <!--ko ifnot: selectedProject().identities.selected().approved() -->
                                                                                    <div class='mpm-user-status user pull-right'>
                                                                                        <span>{% trans 'Not Approved' %}</span>
                                                                                    </div>
                                                                                    <!--/ko-->
                                                                            </div>
                                                                                <div class="mpm-user-subtitle user"><p>{% trans 'Activity: 0 edits' %}</p><div><span>{% trans 'Last Login:' %}</span><span class="last-login" data-bind="text: selectedProject().identities.groupUsers()[0].last_login"></span></div></div>
                                                                            </a>

                                                                        <!--ko if: _.filter(selectedProject().identities.usersGroups(), function(u){return u.approved()}).length > 0 -->
                                                                        <div class="mpm-user-groups">{% trans 'Belongs to the following approved groups:' %}
                                                                            <ul class="user-group-list">
                                                                                <!-- ko foreach: selectedProject().identities.usersGroups() -->
                                                                                <!-- ko if: $data.approved -->
                                                                                <li>
                                                                                    <span class='mpm-user-subtitle' data-bind="text:$data.name"></span>
                                                                                </li>
                                                                                <!--/ko -->
                                                                                <!--/ko -->
                                                                            </ul>
                                                                        </div>
                                                                        <!--/ko-->


                                                                        <!--/ko-->




                                                                    </div>

                                                                    <!-- User Detail -->
                                                                    <div id="user-detail" class="panel hidden" style="box-shadow: none;">
                                                                        <div class="panel-heading">
                                                                            <h3 class="panel-title"><i class="fa fa-arrow-circle-o-left"></i> <a href="" class="">adalgity@getty.edu</a><span class="mpm-user-status pull-right" style="font-size: 13px;">Remove</span></h3>
                                                                        </div>

                                                                        <!-- User Detail -->
                                                                        <div class="mpm-user-summary">
                                                                            <div class="mpm-model-detail-panel">
                                                                                <div class="mpm-node-name">
                                                                                    User Information
                                                                                </div>
                                                                                <ul class="mpm-node-detail-metadata">
                                                                                    <li class="">
                                                                                        Name: Alison Dalgity
                                                                                    </li>
                                                                                    <li class="">
                                                                                        Email: <a hre="">adalgity@getty.edu</a>
                                                                                    </li>
                                                                                    <li class="">
                                                                                        Group Membership: Admins, Editors, RDM Administrators, Mobile Project Manager
                                                                                    </li>
                                                                                </ul>
                                                                            </div>

                                                                            <div class="mpm-model-detail-panel">
                                                                                <div class="mpm-node-name">
                                                                                    Contributions
                                                                                </div>
                                                                                <ul class="mpm-node-detail-metadata">
                                                                                    <li class="">
                                                                                        Edits: 0
                                                                                    </li>
                                                                                    <li>
                                                                                        Devices (2)
                                                                                        <ul class="mpm-node-detail-metadata">
                                                                                            <li class="">
                                                                                                Name: Alison's iPhone (last login: September 17, 2017)
                                                                                            </li>
                                                                                            <li class="">
                                                                                                Name: Getty iPad #12345 (last login: September 2, 2017)
                                                                                            </li>
                                                                                        </ul>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>

                                                                            <div class="mpm-model-detail-panel">
                                                                                <div class="mpm-node-name">
                                                                                    Security
                                                                                </div>
                                                                                <ul class="mpm-node-detail-metadata">
                                                                                    <li class="">
                                                                                        Remove project data from from user's device on next login?
                                                                                    </li>
                                                                                    <li class="">
                                                                                        <!--Switchery : Unchecked-->
                                                                                        <!--===================================================-->
                                                                                        <input id="wipe-project" class="js-switch-small" style="margin-top: 0px; display: none;" data-switchery="true" type="checkbox"><span class="switchery switchery-small" style="box-shadow: rgb(223, 223, 223) 0px 0px 0px 0px inset; border-color: rgb(223, 223, 223); background-color: rgb(255, 255, 255); transition: border 0.4s ease 0s, box-shadow 0.4s ease 0s;"><small style="left: 0px; background-color: rgb(255, 255, 255); transition: left 0.2s ease 0s;"></small></span>
                                                                                        <!--===================================================-->
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Activation Card -->
                                        <div id="activation-card" class="tab-pane fade">
                                            <div class="panel-body card-panel-body" style="">
                                                <div id="" class="card-content" style="">

                                                    <!-- Project Summary Panel -->
                                                    <div class="mpm-activation-panel">
                                                        <!-- Activate Project -->
                                                        <div class="row pad-btm">
                                                            <!-- Activate Switch -->
                                                            <div class="col-sm-5 col-md-3">

                                                                <div class="box-inline">
                                                                    <p class="mpm-item-listing-header" style="margin-bottom: 0px;">Activate Project</p>

                                                                    <div class="toggle-container">
                                                                        <span class="switch switch-small" data-bind="css: {'on': selectedProject().active()}, click: function(){
                                                                            selectedProject().active(!selectedProject().active());
                                                                        }"><small></small></span>
                                                                    </div>

                                                                </div>
                                                            </div>

                                                            <!-- Help Message-->
                                                            <div class="col-sm-6 col-md-9">
                                                                <p class="account-tips" style="margin-top: 20px;">
                                                                    By activating the project you will send users an email with the information needed to begin data editing activitites.
                                                                </p>
                                                            </div>
                                                        </div>

                                                        <!-- Project Settings -->
                                                        <div class="mpm-summary-panel">
                                                            <p class="mpm-item-listing-header" style="margin-bottom: 0px;">
                                                                Project Summary
                                                            </p>
                                                            <ul class="mpm-node-detail-metadata">
                                                                <li class="">
                                                                    Number of edits: 0
                                                                </li>
                                                                <li class="">
                                                                    Contributors: 0
                                                                </li>
                                                                <li class="">
                                                                    Offline Basemap: Streets-Grey
                                                                </li>
                                                            </ul>
                                                        </div>

                                                        <!-- User Summary -->
                                                        <div class="mpm-summary-panel">
                                                            <p class="mpm-item-listing-header" style="margin-bottom: 0px;">
                                                                Groups/Users
                                                            </p>
                                                            <ul class="mpm-node-detail-metadata">
                                                                <li class="">
                                                                    Groups (<span data-bind="text: selectedProject().approvedGroupNames().length"></span>)
                                                                    <ul class="mpm-node-detail-metadata" data-bind="foreach: selectedProject().approvedGroupNames">
                                                                        <li class="" data-bind="text: $data">

                                                                        </li>
                                                                    </ul>
                                                                </li>
                                                            </ul>
                                                            <ul class="mpm-node-detail-metadata">
                                                                <li class="">
                                                                    Users (<span data-bind="text: selectedProject().approvedUserNames().length"></span>)
                                                                    <ul class="mpm-node-detail-metadata">
                                                                        <li class="" data-bind="text: selectedProject().approvedUserNames().join(', ')">

                                                                        </li>
                                                                    </ul>
                                                                </li>
                                                            </ul>
                                                        </div>

                                                        <!-- Model/Card Summary -->
                                                        <div class="mpm-summary-panel">
                                                            <p class="mpm-item-listing-header" style="margin-bottom: 0px;">
                                                                Models and Data Entry Cards
                                                            </p>
                                                            <ul class="mpm-node-detail-metadata">
                                                                <li class="">
                                                                    Assets (3 data entry cards)
                                                                    <ul class="mpm-node-detail-metadata">
                                                                        <li class="">
                                                                            Name, Modification Event, Condition Assessment
                                                                        </li>
                                                                    </ul>
                                                                </li>
                                                            </ul>
                                                            <ul class="mpm-node-detail-metadata">
                                                                <li class="">
                                                                    Investigation Activities (3 data entry cards)
                                                                    <ul class="mpm-node-detail-metadata">
                                                                        <li class="">
                                                                            Name, Event Location, Activity Type
                                                                        </li>
                                                                    </ul>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="project-footer" class="project-footer" style="">

                        </div>
                    </div>
                    <!-- /ko -->


                </div>
            </div>
        </div>
    </div>
</div>
{% endblock main_content %}

{% block tabs %}{% endblock tabs %}

{% block pre_require_js %}
{{block.super}}
    <script>
        {% autoescape off %}define('project-manager-data', [], function() {
            return {
                projects: {{projects}},
                identities: {{identities}}
            };
        });{% endautoescape %}
    </script>
{% endblock pre_require_js %}
